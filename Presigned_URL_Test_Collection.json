{
	"info": {
		"_postman_id": "presigned-url-test-collection",
		"name": "WayToEarth Presigned URL Tests",
		"description": "프로필, 피드, 방명록, 스토리, 랜드마크 이미지 업로드 Presigned URL 테스트 컬렉션",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Mock Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Mock login successful\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('jwtToken');",
									"    ",
									"    // JWT 토큰을 환경변수에 저장",
									"    pm.environment.set(\"jwtToken\", jsonData.data.jwtToken);",
									"    pm.environment.set(\"userId\", jsonData.data.userId.toString());",
									"    ",
									"    console.log(\"JWT Token saved:\", jsonData.data.jwtToken);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/v1/auth/mock-login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"v1",
								"auth",
								"mock-login"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Profile Presigned URL",
			"item": [
				{
					"name": "Profile Image Presign",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// JWT 토큰이 없으면 Mock 로그인 실행",
									"if (!pm.environment.get(\"jwtToken\")) {",
									"    pm.sendRequest({",
									"        url: pm.environment.get(\"baseUrl\") + \"/v1/auth/mock-login\",",
									"        method: 'POST',",
									"        header: {",
									"            'Content-Type': 'application/json'",
									"        },",
									"        body: {",
									"            mode: 'raw',",
									"            raw: JSON.stringify({",
									"                \"userId\": 1",
									"            })",
									"        }",
									"    }, function (err, res) {",
									"        if (!err && res.json().success) {",
									"            pm.environment.set(\"jwtToken\", res.json().data.jwtToken);",
									"            pm.environment.set(\"userId\", res.json().data.userId.toString());",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Presigned URL response is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('upload_url');",
									"    pm.expect(jsonData.data).to.have.property('download_url');",
									"    pm.expect(jsonData.data).to.have.property('key');",
									"    pm.expect(jsonData.data).to.have.property('expires_in');",
									"    ",
									"    console.log(\"Profile presign successful:\", jsonData.data.key);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"contentType\": \"image/jpeg\",\n  \"size\": 2048000\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/v1/files/presign/profile",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"v1",
								"files",
								"presign",
								"profile"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Feed Presigned URL",
			"item": [
				{
					"name": "Feed Image Presign",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// JWT 토큰이 없으면 Mock 로그인 실행",
									"if (!pm.environment.get(\"jwtToken\")) {",
									"    pm.sendRequest({",
									"        url: pm.environment.get(\"baseUrl\") + \"/v1/auth/mock-login\",",
									"        method: 'POST',",
									"        header: {",
									"            'Content-Type': 'application/json'",
									"        },",
									"        body: {",
									"            mode: 'raw',",
									"            raw: JSON.stringify({",
									"                \"userId\": 1",
									"            })",
									"        }",
									"    }, function (err, res) {",
									"        if (!err && res.json().success) {",
									"            pm.environment.set(\"jwtToken\", res.json().data.jwtToken);",
									"            pm.environment.set(\"userId\", res.json().data.userId.toString());",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Feed presigned URL response is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('upload_url');",
									"    pm.expect(jsonData.data).to.have.property('download_url');",
									"    pm.expect(jsonData.data).to.have.property('key');",
									"    pm.expect(jsonData.data).to.have.property('expires_in');",
									"    ",
									"    console.log(\"Feed presign successful:\", jsonData.data.key);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"contentType\": \"image/png\",\n  \"size\": 5120000\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/v1/files/presign/feed",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"v1",
								"files",
								"presign",
								"feed"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Story Presigned URL",
			"item": [
				{
					"name": "Story Image Presign",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// JWT 토큰이 없으면 Mock 로그인 실행",
									"if (!pm.environment.get(\"jwtToken\")) {",
									"    pm.sendRequest({",
									"        url: pm.environment.get(\"baseUrl\") + \"/v1/auth/mock-login\",",
									"        method: 'POST',",
									"        header: {",
									"            'Content-Type': 'application/json'",
									"        },",
									"        body: {",
									"            mode: 'raw',",
									"            raw: JSON.stringify({",
									"                \"userId\": 1",
									"            })",
									"        }",
									"    }, function (err, res) {",
									"        if (!err && res.json().success) {",
									"            pm.environment.set(\"jwtToken\", res.json().data.jwtToken);",
									"            pm.environment.set(\"userId\", res.json().data.userId.toString());",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Story presigned URL response is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('upload_url');",
									"    pm.expect(jsonData.data).to.have.property('download_url');",
									"    pm.expect(jsonData.data).to.have.property('key');",
									"    pm.expect(jsonData.data).to.have.property('expires_in');",
									"    ",
									"    // Key가 스토리 경로로 시작하는지 확인",
									"    pm.expect(jsonData.data.key).to.include('journeys/stories');",
									"    ",
									"    console.log(\"Story presign successful:\", jsonData.data.key);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"contentType\": \"image/jpeg\",\n  \"size\": 6291456\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/v1/story-cards/image/presign",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"v1",
								"story-cards",
								"image",
								"presign"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Landmark Presigned URL",
			"item": [
				{
					"name": "Landmark Image Presign",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// JWT 토큰이 없으면 Mock 로그인 실행",
									"if (!pm.environment.get(\"jwtToken\")) {",
									"    pm.sendRequest({",
									"        url: pm.environment.get(\"baseUrl\") + \"/v1/auth/mock-login\",",
									"        method: 'POST',",
									"        header: {",
									"            'Content-Type': 'application/json'",
									"        },",
									"        body: {",
									"            mode: 'raw',",
									"            raw: JSON.stringify({",
									"                \"userId\": 1",
									"            })",
									"        }",
									"    }, function (err, res) {",
									"        if (!err && res.json().success) {",
									"            pm.environment.set(\"jwtToken\", res.json().data.jwtToken);",
									"            pm.environment.set(\"userId\", res.json().data.userId.toString());",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Landmark presigned URL response is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('upload_url');",
									"    pm.expect(jsonData.data).to.have.property('download_url');",
									"    pm.expect(jsonData.data).to.have.property('key');",
									"    pm.expect(jsonData.data).to.have.property('expires_in');",
									"    ",
									"    // Key가 랜드마크 경로로 시작하는지 확인",
									"    pm.expect(jsonData.data.key).to.include('journeys/landmarks');",
									"    ",
									"    console.log(\"Landmark presign successful:\", jsonData.data.key);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{jwtToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"contentType\": \"image/png\",\n  \"size\": 10485760\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/v1/landmarks/image/presign",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"v1",
								"landmarks",
								"image",
								"presign"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Test All Presigns (Runner)",
			"item": [
				{
					"name": "Run All Presign Tests",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 모든 presign 테스트를 실행하기 전 Mock 로그인",
									"pm.sendRequest({",
									"    url: pm.environment.get(\"baseUrl\") + \"/v1/auth/mock-login\",",
									"    method: 'POST',",
									"    header: {",
									"        'Content-Type': 'application/json'",
									"    },",
									"    body: {",
									"        mode: 'raw',",
									"        raw: JSON.stringify({",
									"            \"userId\": 1",
									"        })",
									"    }",
									"}, function (err, res) {",
									"    if (!err && res.json().success) {",
									"        pm.environment.set(\"jwtToken\", res.json().data.jwtToken);",
									"        pm.environment.set(\"userId\", res.json().data.userId.toString());",
									"        console.log(\"Mock login successful for batch test\");",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Batch presign test setup complete\", function () {",
									"    pm.expect(pm.environment.get(\"jwtToken\")).to.not.be.undefined;",
									"    console.log(\"Ready to run all presign tests\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								""
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Collection 레벨 pre-request script",
					"// 환경 변수 초기화",
					"if (!pm.environment.get(\"baseUrl\")) {",
					"    pm.environment.set(\"baseUrl\", \"http://localhost:8080\");",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Collection 레벨 test script",
					"// 공통 응답 검증",
					"if (pm.response.code !== 404) {",
					"    pm.test(\"Response time is less than 5000ms\", function () {",
					"        pm.expect(pm.response.responseTime).to.be.below(5000);",
					"    });",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "jwtToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "userId",
			"value": "1",
			"type": "string"
		}
	]
}